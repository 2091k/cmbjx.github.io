---
layout: post
title: "BarTender打印数据保存成Excel"
subtitle: ""
author: "晴天，微冷"
header-img: "img/tu/home-blue.jpg"
header-mask: 0.4
category: 技术
tags:
- BarTender
- Excel
---

#### 使用VB代码直接实现

<!-- 通用加密解密模块（密码：236520） -->
<div id="universal-crypto-container" style="margin: 20px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft Yahei', Roboto, sans-serif;">
  <!-- 密码输入区域 -->
  <div id="crypto-prompt" style="padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; margin-bottom: 10px;">
    <p style="margin: 0 0 10px 0; color: #333; font-size: 14px;">请输入密码查看代码：</p>
    <input 
      type="password" 
      id="crypto-pwd" 
      placeholder="输入密码"
      style="padding: 8px 12px; width: 250px; border: 1px solid #ddd; border-radius: 4px; margin-right: 8px; font-size: 14px;"
      onkeydown="if(event.key === 'Enter') decryptText()"
    >
    <button 
      onclick="decryptText()"
      style="padding: 8px 16px; background: #286090; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;"
    >
      解密查看
    </button>
    <p style="margin: 8px 0 0 0; color: #6c757d; font-size: 12px;">提示：输入密码后按回车或点击按钮均可验证</p>
  </div>
  
  <!-- 解密后显示区域 -->
  <div id="crypto-result" style="display: none;">
    <pre style="margin: 0; padding: 16px; background: #f5f5f5; border-radius: 6px; overflow-x: auto;">
      <code class="language-vb" id="decrypted-text" style="color: #333; font-family: Consolas, Monaco, 'Courier New', monospace; font-size: 14px; line-height: 1.5;"></code>
    </pre>
  </div>
</div>

<!-- 引入CryptoJS库 -->
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
<script>
// ===================== 通用解密配置（固定） =====================
const UNIVERSAL_PASSWORD = "236520"; // 固定验证密码：236520
const AES_KEY = CryptoJS.enc.Utf8.parse("1234567890123456"); // 通用密钥（与加密工具一致）
const AES_IV = CryptoJS.enc.Utf8.parse("abcdefghijklmnop");  // 通用向量（与加密工具一致）
// ★★★ 替换为「通用加密工具」生成的密文 ★★★
const ENCRYPTED_TEXT = "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";

// ===================== 通用解密函数 =====================
function decryptText() {
  const pwdInput = document.getElementById("crypto-pwd");
  const inputPwd = pwdInput.value.trim();
  
  // 1. 空密码验证
  if (inputPwd === "") {
    alert("请输入密码后再验证！");
    pwdInput.focus();
    return;
  }
  
  // 2. 密码验证
  if (inputPwd !== UNIVERSAL_PASSWORD) {
    alert("❌ 密码错误！");
    pwdInput.value = "";
    pwdInput.focus();
    return;
  }
  
  try {
    // 3. 解析密文
    const cipherParams = CryptoJS.lib.CipherParams.create({
      ciphertext: CryptoJS.enc.Base64.parse(ENCRYPTED_TEXT)
    });
    
    // 4. AES解密（还原UTF-8二进制数据）
    const decryptedData = CryptoJS.AES.decrypt(cipherParams, AES_KEY, {
      iv: AES_IV,
      mode: CryptoJS.mode.CBC,
      padding: CryptoJS.pad.Pkcs7
    });
    
    // 5. 转为UTF-8字符串（保留中文）
    const originalText = CryptoJS.enc.Utf8.stringify(decryptedData);
    
    // 6. 验证解密结果
    if (!originalText) {
      throw new Error("密文无效，解密结果为空");
    }
    
    // 7. 显示解密后的内容
    document.getElementById("decrypted-text").textContent = originalText;
    document.getElementById("crypto-result").style.display = "block";
    document.getElementById("crypto-prompt").style.display = "none";
    alert("✅ 密码正确！已显示解密内容");
    
  } catch (error) {
    alert("❌ 解密失败：" + error.message + "\n请确认密文是用「通用加密工具」生成的");
    pwdInput.value = "";
    pwdInput.focus();
  }
}

// 页面加载后自动聚焦输入框
window.onload = function() {
  document.getElementById("crypto-pwd").focus();
};
</script>

#### 注意⚠️：具名数据源改成对应名称

脚本事件：OnNewRecord 读取数据库记录之后在打印时执行
